<!DOCTYPE html>
<!-- This site was created with Wowchemy. https://www.wowchemy.com -->
<!-- Last Published: July 9, 2023 -->
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Wowchemy 5.7.0 for Hugo">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; object-src 'none'; frame-src https://platform.twitter.com https://www.youtube.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://platform.twitter.com;">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css" integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin="anonymous" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="/css/wowchemy.f94f26ef6427b410ce6718cb42faf4d2.css">
  <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  <meta name="google-site-verification" content="x-WRee-yVqnJs0JQZzIhmu43FqdyIrIKokjOAFhdL4I">
  <meta name="author" content="Nobuto Murata">
  <meta name="description" content="With Livepatch support in Linux kernel and Livepatch service for Ubuntu, reboots are no longer necessary even when kernel vulnerabilities are found. You can avoid and postpone unplanned reboots to whenever convenient for you, such as scheduled maintenance windows (Well, there are some corner cases which still require reboots though).">
  <link rel="alternate" hreflang="en-US" href="https://nobuto-m.github.io/post/2017/knowing-what-services-need-restart-with-needrestart/">
  <link rel="canonical" href="https://nobuto-m.github.io/post/2017/knowing-what-services-need-restart-with-needrestart/">
  <link rel="icon" type="image/png" href="/media/icon_hu1576a685d49928373d27b4c079446fa6_3195_32x32_fill_lanczos_center_3.png">
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu1576a685d49928373d27b4c079446fa6_3195_180x180_fill_lanczos_center_3.png">
  <meta name="theme-color" content="#1565c0">
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:image" content="https://nobuto-m.github.io/post/2017/knowing-what-services-need-restart-with-needrestart/featured.png">
  <meta property="og:site_name" content="Nobuto Murata">
  <meta property="og:url" content="https://nobuto-m.github.io/post/2017/knowing-what-services-need-restart-with-needrestart/">
  <meta property="og:title" content="Knowing what services need restart with “needrestart” | Nobuto Murata">
  <meta property="og:description" content="With Livepatch support in Linux kernel and Livepatch service for Ubuntu, reboots are no longer necessary even when kernel vulnerabilities are found. You can avoid and postpone unplanned reboots to whenever convenient for you, such as scheduled maintenance windows (Well, there are some corner cases which still require reboots though).">
  <meta property="og:image" content="https://nobuto-m.github.io/post/2017/knowing-what-services-need-restart-with-needrestart/featured.png">
  <meta property="og:locale" content="en-US">
  <meta property="article:published_time" content="2017-07-04T00:00:00&#43;09:00">
  <meta property="article:modified_time" content="2017-07-04T00:00:00&#43;09:00">
  <script type="application/ld+json">
  {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://nobuto-m.github.io/post/2017/knowing-what-services-need-restart-with-needrestart/"
  },
  "headline": "Knowing what services need restart with “needrestart”",

  "image": [
    "https://nobuto-m.github.io/post/2017/knowing-what-services-need-restart-with-needrestart/featured.png"
  ],

  "datePublished": "2017-07-04T00:00:00+09:00",
  "dateModified": "2017-07-04T00:00:00+09:00",

  "author": {
    "@type": "Person",
    "name": "Nobuto Murata"
  },

  "publisher": {
    "@type": "Organization",
    "name": "Nobuto Murata",
    "logo": {
      "@type": "ImageObject",
      "url": "https://nobuto-m.github.io/media/icon_hu1576a685d49928373d27b4c079446fa6_3195_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "With Livepatch support in Linux kernel and Livepatch service for Ubuntu, reboots are no longer necessary even when kernel vulnerabilities are found. You can avoid and postpone unplanned reboots to whenever convenient for you, such as scheduled maintenance windows (Well, there are some corner cases which still require reboots though)."
  }
  </script>
  <title>Knowing what services need restart with “needrestart” | Nobuto Murata</title>
</head>
<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper" data-wc-page-id="94efc66abdbea2e1248661b51065423f">
  <script src="/js/wowchemy-init.min.ec9d49ca50e4b80bdb08f0417a28ed84.js"></script>
  <aside class="search-modal" id="search">
    <div class="container">
      <section class="search-header">
        <div class="row no-gutters justify-content-between mb-3">
          <div class="col-6">
            <h1>Search</h1>
          </div>

          <div class="col-6 col-search-close">
            <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
          </div>
        </div>

        <div id="search-box">
          <input name="q" id="search-query" placeholder="Search..." autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control" aria-label="Search...">
        </div>
      </section>

      <section class="section-search-results">
        <div id="search-hits">
        </div>
      </section>
    </div>
  </aside>

  <div class="page-header header--fixed">
    <header>
      <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
        <div class="container-xl">
          <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation"><span><i class="fas fa-bars"></i></span></button>
          <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">
            <ul class="navbar-nav d-md-inline-flex">
              <li class="nav-item">
                <a class="nav-link" href="/#about"><span>Home</span></a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="/#posts"><span>Posts</span></a>
              </li>

              <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Language</span><span class="caret"></span></a>
                <div class="dropdown-menu">
                  <a class="dropdown-item" href="/ja/post/"><span>日本語</span></a>
                </div>
              </li>
            </ul>
          </div>

          <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
            <li class="nav-item">
              <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
            </li>

            <li class="nav-item dropdown theme-dropdown">
              <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences"><i class="fas fa-moon" aria-hidden="true"></i></a>
              <div class="dropdown-menu">
                <a href="#" class="dropdown-item js-set-theme-light"><span>Light</span></a> <a href="#" class="dropdown-item js-set-theme-dark"><span>Dark</span></a> <a href="#" class="dropdown-item js-set-theme-auto"><span>Automatic</span></a>
              </div>
            </li>
          </ul>
        </div>
      </nav>
    </header>
  </div>

  <div class="page-body">
    <article class="article">
      <div class="article-container pt-3">
        <h1>Knowing what services need restart with “needrestart”</h1>

        <div class="article-metadata">
          <span class="article-date">Jul 4, 2017</span> <span class="middot-divider"></span> <span class="article-categories"><i class="fas fa-folder mr-1"></i><a href="/category/ubuntu/">Ubuntu</a></span>
        </div>
      </div>

      <div class="article-container">
        <div class="article-style">
          <p>With <a href="https://www.kernel.org/doc/Documentation/livepatch/livepatch.txt" target="_blank" rel="noopener">Livepatch support in Linux kernel</a> and <a href="https://www.ubuntu.com/server/livepatch" target="_blank" rel="noopener">Livepatch service for Ubuntu</a>, reboots are no longer necessary even when kernel vulnerabilities are found. You can avoid and postpone unplanned reboots to whenever convenient for you, such as scheduled maintenance windows (Well, there are some corner cases which still require reboots though).</p>

          <p>What about services? After applying security updates of libraries, some services still grab old libraries which may have vulnerabilities. You can list up those processes with “lsof”.</p>

          <div class="highlight">
            <pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo lsof / <span class="p">|</span> egrep -w <span class="s1">&#39;DEL|deleted&#39;</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">apache2 <span class="m">2296</span> root DEL REG 252,0 <span class="m">260616</span> /lib/x86_64-linux-gnu/libcrypto.so.1.0.0
</span></span><span class="line"><span class="cl">apache2 <span class="m">2296</span> root DEL REG 252,0 <span class="m">260711</span> /lib/x86_64-linux-gnu/libssl.so.1.0.0
</span></span><span class="line"><span class="cl">apache2 <span class="m">2299</span> www-data DEL REG 252,0 <span class="m">260616</span> /lib/x86_64-linux-gnu/libcrypto.so.1.0.0
</span></span><span class="line"><span class="cl">apache2 <span class="m">2299</span> www-data DEL REG 252,0 <span class="m">260711</span> /lib/x86_64-linux-gnu/libssl.so.1.0.0
</span></span><span class="line"><span class="cl">...
</span></span></code></pre>
          </div>

          <p>With “lsof”, you have to determine which process belongs to which systemd unit and manually restart those units. There is a helper script called “needrestart”. It is inspired by checkrestart from the debian-goodies package according to their doc. It shows a handy dialogue at the end of <code>apt upgrade</code> and prompts service restarts.</p>

          <figure>
            <div class="d-flex justify-content-center">
              <div class="w-100"><img alt="" src="/post/2017/knowing-what-services-need-restart-with-needrestart/featured.png" loading="lazy" data-zoomable="">
              </div>
            </div>
          </figure>

          <p>To use “needrestart”, you just need to install a package with the same name.</p>

          <div class="highlight">
            <pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo apt install needrestart
</span></span></code></pre>
          </div>

          <p>You can also change the default behavior by editing <code>/etc/needrestart/needrestart.conf</code>. For example, you can enable automatic restart without asking.</p>

          <div class="highlight">
            <pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># Restart services (l)ist only, (i)nteractive or (a)utomatically.
</span></span><span class="line"><span class="cl">#$nrconf{restart} = &#39;i&#39;;
</span></span></code></pre>
          </div>

          <p>Furthermore, it has “nagios” plugin mode(<code>-p</code>) so that it can be integrated with monitoring systems. With this mode, you might want to skip an obsolete kernel check by adding <code>-l</code> flag if kernel patching is managed by Livepatch.</p>

          <div class="highlight">
            <pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo needrestart -p -l
</span></span><span class="line"><span class="cl">CRIT — Services: <span class="m">4</span> <span class="o">(</span>!<span class="o">)</span>, Containers: none, Sessions: <span class="m">1</span> <span class="o">(</span>!<span class="o">)</span><span class="p">|</span><span class="nv">Services</span><span class="o">=</span>4<span class="p">;;</span>0<span class="p">;</span><span class="m">0</span> <span class="nv">Containers</span><span class="o">=</span>0<span class="p">;;</span>0<span class="p">;</span><span class="m">0</span> <span class="nv">Sessions</span><span class="o">=</span>1<span class="p">;</span>0<span class="p">;;</span><span class="m">0</span>
</span></span></code></pre>
          </div>

          <p>Here is an example of Nagios status output.</p>

          <figure>
            <div class="d-flex justify-content-center">
              <div class="w-100"><img alt="" src="/post/2017/knowing-what-services-need-restart-with-needrestart/nagios.png" loading="lazy" data-zoomable="">
              </div>
            </div>
          </figure>

          <blockquote>
            <p><em>This post was originally published at <a href="https://medium.com/@nobuto_m/knowing-what-services-need-restart-with-needrestart-37419f44ed46" target="_blank" rel="noopener">https://medium.com/@nobuto_m/knowing-what-services-need-restart-with-needrestart-37419f44ed46</a></em>
            </p>
          </blockquote>
        </div>

        <div class="article-tags">
          <a class="badge badge-light" href="/tag/planet-ubuntu/">planet-ubuntu</a>
        </div>

        <div class="share-box">
          <ul class="share">
            <li>
              <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fnobuto-m.github.io%2Fpost%2F2017%2Fknowing-what-services-need-restart-with-needrestart%2F&amp;text=Knowing&#43;what&#43;services&#43;need&#43;restart&#43;with&#43;%E2%80%9Cneedrestart%E2%80%9D" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter"><i class="fab fa-twitter"></i></a>
            </li>

            <li>
              <a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fnobuto-m.github.io%2Fpost%2F2017%2Fknowing-what-services-need-restart-with-needrestart%2F&amp;t=Knowing&#43;what&#43;services&#43;need&#43;restart&#43;with&#43;%E2%80%9Cneedrestart%E2%80%9D" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook"><i class="fab fa-facebook"></i></a>
            </li>

            <li>
              <a href="mailto:?subject=Knowing%20what%20services%20need%20restart%20with%20%E2%80%9Cneedrestart%E2%80%9D&amp;body=https%3A%2F%2Fnobuto-m.github.io%2Fpost%2F2017%2Fknowing-what-services-need-restart-with-needrestart%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope"><i class="fas fa-envelope"></i></a>
            </li>

            <li>
              <a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fnobuto-m.github.io%2Fpost%2F2017%2Fknowing-what-services-need-restart-with-needrestart%2F&amp;title=Knowing&#43;what&#43;services&#43;need&#43;restart&#43;with&#43;%E2%80%9Cneedrestart%E2%80%9D" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in"><i class="fab fa-linkedin-in"></i></a>
            </li>
          </ul>
        </div>

        <div class="media author-card content-widget-hr">
          <a href="https://nobuto-m.github.io/"><img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu78a952caf143c499a0d44484a3185536_20286_270x270_fill_q75_lanczos_center.jpg" alt="Nobuto Murata"></a>
          <div class="media-body">
            <h5 class="card-title"><a href="https://nobuto-m.github.io/">Nobuto Murata</a>
            </h5>

            <ul class="network-icon" aria-hidden="true">
              <li>
                <a href="https://twitter.com/nobuto_m" target="_blank" rel="noopener"><i class="fab fa-twitter"></i></a>
              </li>

              <li>
                <a href="https://github.com/nobuto-m" target="_blank" rel="noopener"><i class="fab fa-github"></i></a>
              </li>

              <li>
                <a href="https://nobuto-murata.org/" target="_blank" rel="noopener"><i class="fas fa-globe"></i></a>
              </li>
            </ul>
          </div>
        </div>

        <div class="article-widget content-widget-hr">
          <h3>Related</h3>

          <ul>
            <li>
              <a href="/post/2023/ubuntu-server-autoinstall-with-a-physical-machine/">Ubuntu Server autoinstall with a physical machine</a>
            </li>

            <li>
              <a href="/post/2020/shortcut-key-to-mute-unmute-yourself-in-zoom-or-google-meet/">Shortcut key to mute/unmute yourself in Zoom, Google Meet, or Teams</a>
            </li>

            <li>
              <a href="/post/2018/minimal-dynamic-dns-configuration-for-no-ip.com-with-ddclient/">Minimal Dynamic DNS configuration for No-IP.com with ddclient</a>
            </li>
          </ul>
        </div>
      </div>
    </article>
  </div>

  <div class="page-footer">
    <div class="container">
      <footer class="site-footer">
        <p class="powered-by copyright-license-text">© 2017-2023 Nobuto Murata</p>

        <p class="powered-by">Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.</p>
      </footer>
    </div>
  </div>
  <script src="/js/vendor-bundle.min.32ee83730ed883becad04bc5170512cc.js"></script> 
  <script id="search-hit-fuse-template" type="text/x-template">

    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script> 
  <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script> 
  <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script> 
  <script id="page-data" type="application/json">
  {"use_headroom":true}
  </script> 
  <script src="/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js" type="module"></script> 
  <script src="/en/js/wowchemy.min.91534f6cb18c3621254d412c69186d7c.js"></script>
</body>
</html>
